<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content='text/html;charset=utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no,address=no" />
    <title>全新Jeep大指挥官VR赏车</title>
    <link href="css/reset.v2.0.css" rel="stylesheet" />
    <link href="css/style.v2.0.css" rel="stylesheet" />
    <style type="text/css">
        .spritespin-instance {
            margin: 0px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header outer_head">
            <!--<div class="logo"><span>Jeep K8大指挥官</span></div>-->
            <div class="menu">
                <span class="menu_item">换色</span><span class="menu_item">轮毂</span><span class="menu_item">配置</span>
            </div>
            <div class="outside_sub_menu">
                <div class="sub_menu clear">
                    <div class="sub_menu_wrap">
                            <span carcolor="blue" class="sub_menu_item active_item" data-url="./images/1.jpg">地中海蓝</span>
                            <span carcolor="black" class="sub_menu_item " data-url="./images/2.jpg">北极黑</span>
                            <span carcolor="red" class="sub_menu_item " data-url="./images/3.jpg">波尔多红</span>
                            <span carcolor="brown" class="sub_menu_item " data-url="./images/4.jpg">阿布扎比棕</span>
                            <span carcolor="white" class="sub_menu_item " data-url="./images/4.jpg">喀纳斯白</span>
                            <span carcolor="crystal" class="sub_menu_item " data-url="./images/4.jpg">西西里灰</span>
                    </div>
                </div>
                <div class="sub_menu clear">
                    <div class="sub_menu_wrap">
                        <span carhub="summit" class="sub_menu_item active_item" data-url="./images/3.jpg">Summit</span>
                        <span carhub="overland" class="sub_menu_item" data-url="./images/4.jpg">Overland</span>
                        <span carhub="limited" class="sub_menu_item" data-url="./images/5.jpg">Limited</span>
                    </div>
                </div>
                <div class="sub_menu sub_config_1 clear">
                    <div class="sub_menu_wrap">
                        <span class="sub_menu_item active_item" data-title="动感大气" data-content="源自大切诺基的豪华大气的旗舰家族设计语言传承：家族式7孔格栅设计、4轮梯形轮眉、粗壮的肩线眼神至D柱4873/1892/1738mm大气车身尺寸，2800mm长轴距外观风格刚中带柔，在平面中凸显雕塑感">动感大气</span>
                        <span class="sub_menu_item" data-title="精湛高科技" data-content="同级唯一全系标配全LED灯组，远近光灯+日行灯+尾灯，采用最流行的LED光源">精湛高科技</span>
                        <span class="sub_menu_item" data-title="豪华空间感" data-content="车身漆面应用玛莎拉蒂的色彩配方门板设计由灰色装饰缝线、亚光电镀镶边、棕色实木饰条组成">豪华空间感</span>
                        <span class="sub_menu_item" data-title="动力" data-content="超强心脏2.0T+9AT汽油发动机最领先六大技术，首次集成于一台发动机最强民用2.0T较同级，性能领先15%，排放标准领先3年8秒8升黄金平衡">动力</span>
                        <span class="sub_menu_item" data-title="安全" data-content="以欧盟和美国最高安全标准打造IIHS美国高速公路安全协会及E-NCAP欧盟安全认证中心最高标准打造77年史上最硬Jeep：76%高强度钢材车身80项主被动安全科技">安全</span>
                        <span class="sub_menu_item" data-title="四驱" data-content="薛定谔的四驱，守护和燃油经济兼得4X4=17种路况下的默默守护全场和、全天候、全路况环境下提供最安全安心的驾驶出行">四驱</span>
                    </div>

                </div>
                <div class="show_more">
                    <img src="./images/CombinedShape.png" alt="">
                </div>
            </div>
        </div>
        <div class="header inner_head">
            <!--<div class="logo"><span>Jeep K8大指挥官</span></div>-->
            <div class="menu">
                <span class="menu_item">换色</span><span class="menu_item">视角</span><span class="menu_item">配置</span>
            </div>
            <div class="outside_sub_menu">
                <div class="sub_menu clear">
                    <div class="sub_menu_wrap">
                        <span vrcolor="brown" class="sub_menu_item  active_item" data-url="./images/1.jpg">黑/棕</span>
                        <span vrcolor="grey" class="sub_menu_item " data-url="./images/2.jpg">黑/灰</span>
                        <span vrcolor="black" class="sub_menu_item " data-url="./images/3.jpg">黑/黑</span>
                    </div>
                </div>

                <div class="sub_menu clear">
                    <div class="sub_menu_wrap">
                        <span vrangle="0" class="sub_menu_item active_item" data-url="./images/5.jpg">驾驶位视角</span>
                        <span vrangle="1" class="sub_menu_item" data-url="./images/6.jpg">中排视角</span>
                        <span vrangle="2" class="sub_menu_item" data-url="./images/7.jpg">后排视角</span>
                    </div>

                </div>

              <div class="sub_menu sub_config_2 clear">
                <div class="sub_menu_wrap">
                  <span vrplace="0" class="sub_menu_item active_item" data-title="人机工程" data-content="<P>空间：同级最大三排头部空间；同级最大第三排调节角度范围；最长座椅靠垫；最优秀第三排腿部空间，最平坦第三排地板</p><p>隐私：同级唯一后排遮阳帘+隐私玻璃</p><P>视野：同级最大1.23平米全景天窗，同级最佳第三排视野</p>">人机工程</span>
                  <span vrplace="1" class="sub_menu_item" data-title="材质" data-content="材质：同级唯一全三排麂皮打孔绒面/Nappa头层小牛皮座椅，同级唯一360度皮与真木包裹内饰">材质</span>
                  <span vrplace="2" class="sub_menu_item" data-title="科技" data-content="<p>科技：更人性化的U-connect系统</p><p>听觉：第三排剧院级音箱</p><p>温度：第三排独立空调</P>">科技</span>
                </div>
              </div>
                <div class="show_more">
                    <img src="./images/CombinedShape.png" alt="" class="combined_shape">
                </div>
            </div>

        </div>
        <div class="content">
            <!--<img src="./images/0.jpg" alt="" class="car">-->
            <div id="360ShowContent"></div>
            <iframe id="VRShowContent" frameborder="0" class="vr_content"></iframe>
            <div class="describe">
                <p class="des_title"></p>
                <p class="des_content">
                    FCA 集团全新一代2.0T发动机，同级别最强升功率/升扭矩（汽油机罕见达到
                    200N·m），欧洲进口技术+满足欧六排放标准，全新正时系统、全铝结构、众多高科技加持
                </p>
            </div>
            <div class="reserve lightSpeedIn"><a href="http://i.bsitt.cn/3nEfQ">立即预定</a></div>
            <img src="./images/circulation.png" alt="" class="circulation">
        </div>
        <div onclick="Switchover(this)" id="SwitchoverBtn" class="footer">点击进入内饰页</div>
        <div class="box"><div class="boxLoading"></div><p>0%</p></div>
    </div>
    <div class="loading_wrap">
        <img src="./images/loading.gif" alt="" class="loading_in">
    </div>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/spritespin.min.js"></script>
    <script type="text/javascript">
        //默认选择蓝色
        var SelectedCarColor = "blue";
        //轮毂
        var SelectedCarHub = "summit";
        //内饰颜色
        var SelectedCarHubInteriorColor = "brown";
        //内饰选择的角度
        var SelectedCarHubInteriorAngle = 0;
        //内饰选择的位置
        var SelectedCarHubInteriorPlace = [0, 0, 0];
        var $innerHead = $('.inner_head');
        var $head = $('.outer_head');
        var $boxLoading = $('.box');
        var totalWidth = 0;
        var shapeFlag = false;
        var $combinedShape = $('.combined_shape');
        var $subMenuItem = $('.sub_menu_item');
        var $showMore = $('.show_more');
        var $SwitchoverBtn = $('#SwitchoverBtn');
        var $describe = $('.describe');
        var $desTitle = $('.des_title');
        var $desContent = $('.des_content');
        $(document).ready(function () {
            var $menuItem = $('.menu_item');
            var $subMenu = $('.sub_menu');
            var $car = $('.car');
            var index = 1;
            var lastIndex = 1;
            var num = 60;
            var speed = 50;
            $('.reserve').css('right', '0');
            // 顶上menu切换
            $menuItem.on('click', function (e) {
                e.stopPropagation();
                var $me = $(this);
                var idx = $me.index();
                $menuItem.removeClass('active_menu');
                $me.addClass('active_menu');
                if (!innerOrOuter()) {
                    idx = idx + 3;
                }
                $subMenu.removeClass('active_sub_menu');
                console.log($subMenu[0]);
                $subMenu.eq(idx).addClass('active_sub_menu');
                // 计算菜单宽度
                 calWidth();

                if($me.text() != '配置') {
                    $describe.hide();
                } else if (innerOrOuter()){
                    var $sp = $('.sub_config_1').find('span').eq(0);
                    $('.sub_config_1').find('span').removeClass("active_item");
                    $sp.addClass("active_item");
                    renderText($sp.data('title'), $sp.data('content'))
                } else {
                    var $te = $('.sub_config_2').find('span').eq(0);
                    $('.sub_config_2').find('span').removeClass("active_item");
                    $te.addClass("active_item");
                    renderText($te.data('title'), $te.data('content'))
                }
            });
            // 二级菜单
            $subMenuItem.on('click', function (e) {
                e.stopPropagation();
                //$boxLoading.show();
                var $me = $(this);
                $subMenuItem.removeClass('active_item');
                $me.addClass('active_item');
                console.log($me);
                $car.attr('src', $me.data('url'));
                if($me.data('title')) {
                    renderText($me.data('title'), $me.data('content'))
                }
                //判断是否是颜色的选择
                if ($me.attr("carcolor") != undefined) {
                    SelectedCarColor = $me.attr("carcolor");
                    Load360();
                }
                //轮毂
                if ($me.attr("carhub") != undefined) {
                    SelectedCarHub = $me.attr("carhub");
                    Load360();
                }
                //内饰颜色
                if ($me.attr("vrcolor") != undefined) {
                    SelectedCarHubInteriorColor = $me.attr("vrcolor");
                    LoadVR();
                }
                //内饰角度
                if ($me.attr("vrangle") != undefined) {
                    SelectedCarHubInteriorAngle = parseInt($me.attr("vrangle"));
                    //调用if里面的方法
                    $("#VRShowContent")[0].contentWindow.switchover(SelectedCarHubInteriorAngle);
                }
                MenuPitchOn();
            });
            var scrollTimer;
            $('.sub_menu_wrap').on('scroll', function () {
                var $me = $(this);
                if (shapeFlag) {
                    if (!scrollTimer) {
                        scrollTimer = setTimeout(function () {
                            console.log($me.scrollLeft())
                            console.log(totalWidth - $('.container').width() - 10)
                            if ($me.scrollLeft() >= totalWidth - $('.container').width() - 10) {
                                $showMore.hide();
                            } else {
                                $showMore.show();
                            }
                            scrollTimer = undefined;
                        }, 100);
                    }
                }

            });
            //菜单选中
            MenuPitchOn();
            //加载默认颜色的360
            Load360();
        })
        function Load360() {
            $("#VRShowContent").hide();
            $("#360ShowContent").show();
            var width = window.screen.availWidth;
            var height = (width / 9) * 16;
            var frames = SpriteSpin.sourceArray('./images/' + SelectedCarColor + '_' + SelectedCarHub + '/' + SelectedCarColor + '_' + SelectedCarHub + '_{frame}.jpg', { frame: [0, 60], digits: 3 });
            var loadIndex = 0;
            $("#360ShowContent").spritespin({
                width: width,
                height: height,
                behavior: "drag",
                module: "360",
                sense: -1,
                source: frames,
                animate: false,
                onInit: function () {
                    $(".box").show();
                    loadIndex = 0;
                    console.log("正在加载");
                },
                onProgress: function (a, b, c, d) {
                    loadIndex = loadIndex + 1;
                    var p = parseInt(parseFloat(parseFloat(loadIndex) / frames.length) * 100);
                    if (p > 100) {
                        p = 100;
                    }
                    $(".box p").html(p + "%");
                },
                onLoad: function () {
                    console.log("加载完成");
                    $(".box").hide();
                    $(".box p").html("0%");
                    //$('.loading_wrap').hide();
                }
            });
            setTimeout(function () {
                $('.loading_wrap').hide();
            }, 3000);
//            $boxLoading.hide();
        }
        function LoadVR() {
            $("#VRShowContent").show();
            $("#360ShowContent").hide();
            var width = window.screen.availWidth;
            var height = window.screen.availHeight;
            $("#VRShowContent").css("height", (height - 64) + "px");
            $("#VRShowContent").attr("src", "./vr/" + SelectedCarHubInteriorColor + "/index.html");
            $('.container').css('height', $('iframe').height() + 64 + 'px');
            $('.content').css({'height': $('.container').height() - 90 + 'px', 'padding-top': '90px'});
            //加载效果
            $(".box").show();
            var pro = 1;
            var t= setInterval(function () {
                pro =parseInt(pro + (Math.random()*10));
                if (pro > 90) {
                    pro = 91;
                }
                $(".box p").html(pro + "%");
                clearInterval(t);
            }, 1000);
        }
        //处理菜单选中
        function MenuPitchOn() {
//            $('.sub_menu_item').removeClass('active_item');
            $('.sub_menu_item[carcolor="' + SelectedCarColor + '"]').addClass('active_item');
            $('.sub_menu_item[carhub="' + SelectedCarHub + '"]').addClass('active_item');
            $('.sub_menu_item[vrcolor="' + SelectedCarHubInteriorColor + '"]').addClass('active_item');
            console.log($('.sub_menu_item[vrangle="' + SelectedCarHubInteriorAngle + '"]').length, SelectedCarHubInteriorAngle);
            $('.sub_menu_item[vrangle="' + SelectedCarHubInteriorAngle + '"]').addClass('active_item');
        }
        function Switchover(obj) {
            if ($(obj).text() == "点击进入内饰页") {
                $(obj).text("点击进入外观页");
                $(".circulation").hide();
                //内饰
                LoadVR();
                $head.hide();
                $innerHead.show();
                $describe.hide();
            } else {
                $(obj).text("点击进入内饰页");
                $(".circulation").show();
                //外观
                Load360();
                $innerHead.hide();
                $head.show();
                $describe.hide();
                $('.content').css({'height':'auto','padding-top': '0'});
            }
        }
        //加载完毕之后(VR)
        function HideLoading() {
            //$('.loading_wrap').hide();
            $(".box").hide();
            $(".box p").html("0%");
            //设置场景
            $("#VRShowContent")[0].contentWindow.switchover(SelectedCarHubInteriorAngle);
        }
        function calWidth() {
            var temp = 0;
            totalWidth = 0
            $subMenuItem.each(function(i, v) {
                temp += $(v).width()?$(v).width()+ 20 : 0;
            })
            totalWidth += temp + 10 + 10;
            if(totalWidth > $('.container').width()) {
                shapeFlag = true;
                $showMore.show();
            } else {
                shapeFlag = false;
                $showMore.hide();
            }
            console.log(totalWidth , shapeFlag);
        }

        // 判断是在外观页还是内饰页 内饰页flase, 外观true
        function innerOrOuter() {
            if ($SwitchoverBtn.text() === '点击进入外观页') {
                return false;
            } else {

                return true;
            }
        }

        // 文字描述
        function renderText(eTitle,  eCon) {
//            $desTitle.text(eTitle);
            $desContent.html('更多配置详情，敬请期待<br /><br /><br />');
            $('.describe').show();
        }
    </script>
</body>
</html>